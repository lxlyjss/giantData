<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>giant数据</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/daterangepicker.css"/>
		<link rel="stylesheet" type="text/css" href="css/lxl.css"/>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script src="js/setFilter.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/moment.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/daterangepicker.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/main.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript">
			$(function (){
				//判断当前设备屏幕宽度
				var deviceWidth = $(document).width();
				if(deviceWidth > 1000){
					$("body").addClass("nav-md");
				}else{
					$("body").addClass("nav-sm");
				}
				//当前文档的高度
				$("#aside").css("height",$(document).height());
				$(window).resize(function (){
					$("#aside").css("height",$(document).height());
				});
			});
		</script>
	</head>
	<body class="service-list">
        <div class="loading-wrapper" style="display: block;">
            <div class="spinner"></div>
        </div>
		<div id="page">
			<div id="aside">
				<div class="navbar">
					<div class="return-giant">
						<a href="http://www.giant.com.cn">
						<i class="iconfont icon-fangxiangzuo"></i>
						<span>返回捷安特官网</span></a>
					</div>
					<div class="user-info">
						<div class="user-img">
							<div class="user-img-circle">
								<img src="img/img.jpg" alt="" />
							</div>
						</div>
						<div class="user-welcome">
							<p>经销商</p>
							<p>大熊猫</p>
						</div>
					</div>
					<div class="close-btn">
						<i class="iconfont icon-guanbi"></i>
					</div>
					<ul class="nav-slide-menu">
                        <li class="nav-list home-page">
                            <a href="index.html">
                                <i class="iconfont icon-home"></i>
                                首页
                            </a>
                        </li>
                        <li class="nav-list home-page">
                            <a>
                                <i class="iconfont icon-xiaoxi"></i>
                                产品
                                <i class="iconfont icon-fangxiangyou"></i>
                            </a>
                            <ul class="child-slide-menu">
                                <li class="current">
                                    <a href="productsList.html">产品评价列表</a>
                                </li>
                                <li>
                                    <a href="productData2.html">产品销量数据</a>
                                </li>
                                <li>
                                    <a href="productData1.html">区域销量数据</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-list">
                            <a>
                                <i class="iconfont icon-shuju"></i>
                                会员
                                <i class="iconfont icon-fangxiangyou"></i>
                            </a>
                            <ul class="child-slide-menu">
                                <li>
                                    <a href="vip-list.html">会员列表</a>
                                </li>
                                <li>
                                    <a href="vip-from.html">会员来源</a>
                                </li>
                                <li>
                                    <a href="vip-change.html">会员变化趋势</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-list active">
                            <a>
                                <i class="iconfont icon-xiaoxi"></i>
                                门店
                                <i class="iconfont icon-fangxiangyou"></i>
                            </a>
                            <ul class="child-slide-menu" style="display: block;">
                                <li class="current">
                                    <a href="service-list.html">服务评价列表</a>
                                </li>
                                <li>
                                    <a href="javascript:;">通路积分列表</a>
                                </li>
                                <li>
                                    <a href="javascript:;">积分记录</a>
                                </li>
                            </ul>
                        </li>
					</ul>
				</div>
			</div>
			<!--左侧边栏结束-->
			<!--右侧内容开始-->
			<div id="content">
				<!--头部 开始-->
				<div class="header">
					<div class="menu-btn">
						<i class="iconfont icon-caidan caidan-btn"></i>
					</div>
					<div class="header-title">
						<p>捷安特大数据中心</p>
					</div>
					<div class="user-manage">
						<div class="user-content">
							<img src="img/img.jpg" alt="" />
							<span>大熊猫</span>
							<i class="iconfont icon-fangxiangxia"></i>
						</div>
						<ul class="drop-down">
							<li>帮助</li>
							<li>个人资料</li>
							<li><a href="http://www.giant.com.cn/front/loginout"></a>退出</li>
						</ul>
					</div>
				</div>
				<!--头部 结束-->
				<!--中间内容开始-->
				<div class="content">
					<!--title start -->
					<div class="row page-title">

					</div>
					<!--title end -->
					<!--查询条件-->
					<div class="row search-content">
						<div class="col-md-3">
							<div class="input-group filter-select">
								<span class="input-group-addon">区域</span>
								<select id="areaList" class="form-control">
									<option value="">全部</option>
								</select>
							</div>
						</div>
						<div class="col-md-3">
							<div class="input-group filter-select">
								<span class="input-group-addon">门市形态</span>
								<select id="storePropertys" class="form-control">
									<option value="">全部</option>
								</select>
							</div>
						</div>
						<div class="col-md-3">
							<div class="input-group filter-select">
								<span class="input-group-addon">门店状态</span>
								<select id="storeStatus" class="form-control">
									<option value="">全部</option>
								</select>
							</div>
						</div>
						<div class="col-md-3">
							<div class="input-group filter-select">
								<span class="input-group-addon">门店类型</span>
								<select id="storeType" class="form-control">
									<option value="">全部</option>
								</select>
							</div>
						</div>
						<div class="col-md-2 search-btn">
							<button class="btn btn-primary">查询</button>
						</div>
					</div>
					<!--查询条件-->
					<!--会员数据-->
					<div class="row vip-wrapper" style="background: #fff;">
                        <div class="result-title">
                            <p style="line-height: 40px;color: #fff;padding-left: 20px;">当前展示的为<span id="tagTitle">全部</span>的数据</p>
                        </div>
						<div class="col-md-12 col-sm-12" style="z-index: 9;">
							<div class="vip-container">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr style="text-align: center">
                                                <th>门店名称</th>
                                                <th>门店代码</th>
                                                <th>经销商代码</th>
                                                <th>SBU</th>
                                                <th>服务态度评价分</th>
                                                <th>技师水平评价分</th>
                                                <th>评价内容</th>
                                                <th>技师账号</th>
                                                <th>评价会员账号</th>
                                                <th>评价时间</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
							</div>
						</div>
						<div class="col-md-12 page-container">
							<nav aria-label="Page navigation">
								<ul class="pagination">
									<li><a href=\"javascript:;\" aria-label=\"Previous\"><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\">1</a></li><li><a href=\"javascript:;\">...</a></li><li><a href=\"javascript:;\">"+ (p-3) +"</a></li><li><a href=\"javascript:;\">"+ (p - 2) +"</a></li><li><a href=\"javascript:;\">"+(p-1)+"</a></li><li><a href=\"javascript:;\">"+p+"</a></li><li><a href=\"javascript:;\">"+p+"</a></li><li><a href=\"javascript:;\" aria-label=\"Next\"><span aria-hidden=\"true\">下一页</span></a></li>
								</ul>
							</nav>
						</div>
					</div>
					<!--会员数据-->
				</div>
				<!--中间内容结束-->
			</div>
			<!--右侧内容结束-->
		</div>
		<script>
            //根据时间段,区域(不同角色看到不同的区域),门店类型,门店状态,门市形态做筛选
			function setEvalusteData() {//评价
                //请求数据,评价总数,
                var evalCount;
                //当前页数
                var nowPage;
                //总页数
                var allPage;
                //存储评论列表数据
                var evalData = null;
                //页面是否初始化
                var isStart = true;
                //存储筛选条件
                var filterData = null;
                //当前筛选条件
                var filter = {
                    dateArea:getDefaultDate(),
                    userId:"721048",
                    page:nowPage,
                    pageNum:10,
                    rolecode:"",
                    shopPro:"",
                    storeStatus:"",
                    shopType:""
                };
                if (isStart) {
                    nowPage = 1;
                    getAjaxData();
                    getFilterData();
                }
                //选页
                window.selectPage = function (n) {
                    showLoading(true);
                    cutPage(allPage, n);
                    filter.page = n;
                    nowPage = n;
                    getAjaxData();
                };

                //获取后台数据,页面初始化
                function getAjaxData() {
                    $.ajax({
                        url: "http://192.168.9.20:8080/giantService/storeEva/storeEvaList",
                        data: {
                            userId: filter.userId,
                            page: filter.page,
                            pageNum: filter.pageNum,
                            dateArea: filter.dateArea,
                            rolecode: filter.rolecode,
                            shopPro: filter.shopPro,
                            storeStatus: filter.storeStatus,
                            shopType: filter.shopType
                        },
                        async: false,
                        dataType: "json",
                        type: "get",
                        beforeSend:function (){
                            showLoading(true);
                        },
                        success: function (result) {
                            console.log(result)
                            showLoading(false);//隐藏loading动画
                            evalData = result;//赋值给evalData;
                            evalCount = evalData.count;
                            allPage = Math.ceil(evalCount / 10);
                            cutPage(allPage, nowPage);
                            showData();
                        }
                    });
                }

                //展示数据
                function showData() {
                    var pageData = evalData.list;
                    var tempList = [];
                    for (var i = 0; i < pageData.length; i++) {
                        var temp = $("<tr style=\"text-align: center;\">" +
                            "<td>" + pageData[i].storeName + "</td>" +
                            "<td>" + pageData[i].storeCode + "</td>" +
                            "<td>" + pageData[i].dealerCode + "</td>" +
                            "<td>" + pageData[i].sbuCode + "</td>" +
                            "<td>" + pageData[i].service + "</td>" +
                            "<td>" + pageData[i].person + "</td>" +
                            "<td>" + pageData[i].content + "</td>" +
                            "<td>" + pageData[i].personNumber + "</td>" +
                            "<td>" + pageData[i].userName + "</td>" +
                            "<td>" + pageData[i].date + "</td>" +
                            "</tr>");
                        tempList.push(temp);
                    }
                    $(".vip-container table tbody").empty().append(tempList);
                }

                //分页
                function cutPage(p, n) {
                    if(p >= 0 && p <= 5){
                        if(p == 1 || p == 0){
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        }else if(p == 2){
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" onclick='selectPage(2)'>2</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        }else if(p == 3){
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" onclick='selectPage(2)'>2</a></li><li><a href=\"javascript:;\" onclick='selectPage(3)'>3</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        }else if(p == 4){
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" onclick='selectPage(2)'>2</a></li><li><a href=\"javascript:;\" onclick='selectPage(4)'>3</a></li><li><a href=\"javascript:;\" onclick='selectPage(4)'>4</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        }else if(p == 5){
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" onclick='selectPage(2)'>2</a></li><li><a href=\"javascript:;\" onclick='selectPage(3)'>3</a></li><li><a href=\"javascript:;\" onclick='selectPage(4)'>4</a></li><li><a href=\"javascript:;\" onclick='selectPage(5)'>5</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        }
                    }else if(p > 5){
                        if (n <= 4 && n != "" && n > 0) {
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\" onclick='selectPage(2)'>2</a></li><li><a href=\"javascript:;\" onclick='selectPage(3)'>3</a></li><li><a href=\"javascript:;\" onclick='selectPage(4)'>4</a></li><li><a href=\"javascript:;\" onclick='selectPage(5)'>5</a></li><li><a href=\"javascript:;\">...</a></li><li><a href=\"javascript:;\"onclick='selectPage(" + p + ")'>" + p + "</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(n).addClass("active");
                        } else if (n > 4 && n <= (p - 4)) {
                            $(".page-container .pagination").html("<li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\">...</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (n - 1) + ")'>" + (n - 1) + "</a></li><li class=\"active\"><a href=\"javascript:;\" onclick='selectPage(" + n + ")'>" + n + "</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (n + 1) + ")'>" + (n + 1) + "</a></li><li><a href=\"javascript:;\">...</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + p + ")'>" + p + "</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                        } else if (n > (p - 4) && n <= p) {
                            $(".page-container .pagination").html(" <li><a href=\"javascript:;\" aria-label=\"Previous\" onclick='selectPage(" + (n - 1) + ")'><span aria-hidden=\"true\">上一页</span></a></li><li><a href=\"javascript:;\" onclick='selectPage(1)'>1</a></li><li><a href=\"javascript:;\">...</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (p - 4) + ")'>" + (p - 4) + "</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (p - 3) + ")'>" + (p - 3) + "</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (p - 2) + ")'>" + (p - 2) + "</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + (p - 1) + ")'>" + (p - 1) + "</a></li><li><a href=\"javascript:;\" onclick='selectPage(" + p + ")'>" + p + "</a></li><li><a href=\"javascript:;\" aria-label=\"Next\" onclick='selectPage(" + (n + 1) + ")'><span aria-hidden=\"true\">下一页</span></a></li>");
                            $(".page-container .pagination li").eq(7 - (p - n)).addClass("active");
                        }
                    }
                }

                //获取筛选条件
                function getFilterData() {
                    $.ajax({
                        url: "http://192.168.9.20:8080/giantService/storeEva/conditionEva",
                        data: {
                            userId: "721048"
                        },
                        async: false,
                        dataType: "json",
                        type: "get",
                        success: function (resultData) {
                            if (resultData.result == 1) {
                                filterData = resultData;
                                console.log(filterData)
                                //添加区域条件
                                setFilterData($("#areaList"), filterData.areaList);
                                //添加门市形态
                                setFilterData($("#storePropertys"), filterData.storePropertys);
                                //添加门店类型
                                setFilterData($("#storeType"), filterData.storeTypes);
                                //添加门店状态
                                setFilterData($("#storeStatus"), filterData.storeStatus);
                            } else {
                                alert("获取数据失败!result=0!");
                            }
                        },
                        error: function (error) {
                            alert("获取数据失败!请重新刷新网页!");
                        }
                    });
                }

                //设置筛选条件
                function setFilterData(ele, aData) {
                    //设置区域条件
                    var tempList = [];
                    for (var i = 0; i < aData.length; i++) {
                        if(typeof aData[i] == "object"){
                            var temp = $("<option value='"+aData[i].dictCode+"'>" + aData[i].dictName + "</option>");

                            tempList.push(temp);
                        }else{
                            var temp = $("<option value='"+aData[i]+"'>" + aData[i] + "</option>");

                            tempList.push(temp);
                        }
                    }
                    ele.append(tempList);
                }
                //设置默认时间段
                function getDefaultDate(){
                    var dateArea;
                    var startDate = moment().subtract(30,'days').format("YYYYMMDD");
                    var endDate = moment().subtract(1,'days').format("YYYYMMDD");
                    dateArea = startDate+","+endDate;
                    return dateArea;
                }
                //是否显示loading动画
                function showLoading(y){
                    if(y){
                        $(".loading-wrapper").show();
                    }else{
                        $(".loading-wrapper").hide();
                    }
                }
                $(".search-btn .btn").click(function (){
                    filter.rolecode = $("#areaList").val();
                    filter.shopPro = $("#storePropertys").val();
                    filter.storeStatus = $("#storeStatus").val();
                    filter.shopType = $("#storeType").val();
                    nowPage = 1;
                    getAjaxData();
                });
			}
            setEvalusteData();
		</script>
	</body>
</html>
